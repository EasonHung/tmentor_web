{"ast":null,"code":"import { getClassroomId } from \"../../../api_handler/classroom_api_handler\";\nimport { getUserId } from \"../../../cookie_handler/user_cookie_handler\";\nconst iceServers = {\n  'iceServers': [\n  // {'url': 'stun:stun.l.google.com:19302'},\n  {\n    \"url\": \"turn:relay1.expressturn.com:3478\",\n    \"username\": \"efC2OT8W129D2ID63H\",\n    \"credential\": \"6ZeChztFE4cxEmgg\"\n  }]\n};\nconst videoConstraints = {\n  audio: false,\n  video: true\n};\nlet pc = null;\nexport async function onRTCOffer(setRemoteStream, setLocalStream, message, classroomWs) {\n  pc = new RTCPeerConnection(iceServers);\n  pc.ontrack = event => {\n    setRemoteStream(event.streams[0]);\n  };\n  pc.onicecandidate = async _ref => {\n    let {\n      candidate\n    } = _ref;\n    if (candidate != null) {}\n  };\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(videoConstraints);\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n  } catch (err) {\n    console.error(err);\n  }\n  await pc.setRemoteDescription(new RTCSessionDescription(message.message));\n  await pc.setLocalDescription(await pc.createAnswer());\n  classroomWs.send(JSON.stringify({\n    \"cmd\": \"answer\",\n    \"senderId\": getUserId(),\n    \"applicationType\": \"app\",\n    \"recieverId\": message.senderId,\n    \"classroomId\": await getClassroomId(),\n    \"message\": {\n      'sdp': pc.localDescription.sdp,\n      'type': pc.localDescription.type\n    }\n  }));\n}\nexport async function onICECandidate(message) {\n  if (pc !== null) {\n    pc.addIceCandidate(new RTCIceCandidate(message.message));\n  }\n}\nexport async function startLocalStream(setLocalStream) {\n  const stream = await navigator.mediaDevices.getUserMedia({\n    audio: false,\n    video: true\n  });\n  setLocalStream(stream);\n}\nexport function stopLocalStream(setLocalStream) {\n  setLocalStream({});\n}","map":{"version":3,"names":["getClassroomId","getUserId","iceServers","videoConstraints","audio","video","pc","onRTCOffer","setRemoteStream","setLocalStream","message","classroomWs","RTCPeerConnection","ontrack","event","streams","onicecandidate","_ref","candidate","stream","navigator","mediaDevices","getUserMedia","getTracks","forEach","track","addTrack","err","console","error","setRemoteDescription","RTCSessionDescription","setLocalDescription","createAnswer","send","JSON","stringify","senderId","localDescription","sdp","type","onICECandidate","addIceCandidate","RTCIceCandidate","startLocalStream","stopLocalStream"],"sources":["/Users/hongyixun/Desktop/tmentor/tmentor_web/src/pages/classroom/service/webRTC_service.js"],"sourcesContent":["import { getClassroomId } from \"../../../api_handler/classroom_api_handler\";\nimport { getUserId } from \"../../../cookie_handler/user_cookie_handler\";\n\nconst iceServers = {\n    'iceServers': [\n        // {'url': 'stun:stun.l.google.com:19302'},\n        {\n        \"url\": \"turn:relay1.expressturn.com:3478\",\n        \"username\": \"efC2OT8W129D2ID63H\",\n        \"credential\": \"6ZeChztFE4cxEmgg\",\n        },\n    ]\n};\nconst videoConstraints = {\n    audio: false, \n    video: true\n}\n\nlet pc = null\n\n\nexport async function onRTCOffer(setRemoteStream, setLocalStream, message, classroomWs) {\n    pc = new RTCPeerConnection(iceServers);\n\n    pc.ontrack = (event) => {\n        setRemoteStream(event.streams[0])\n    };\n\n    pc.onicecandidate = async ({candidate}) => {\n        if(candidate != null) {\n\n        }\n    }\n\n    try {\n        const stream = await navigator.mediaDevices.getUserMedia(videoConstraints);\n        stream.getTracks().forEach( (track) =>\n          pc.addTrack(track, stream)\n        )\n    } catch (err) {\n        console.error(err);\n    }\n\n    await pc.setRemoteDescription(new RTCSessionDescription(message.message));\n\n    await pc.setLocalDescription(await pc.createAnswer());\n\n    classroomWs.send(\n        JSON.stringify({\n            \"cmd\": \"answer\",\n            \"senderId\": getUserId(),\n            \"applicationType\": \"app\",\n            \"recieverId\": message.senderId,\n            \"classroomId\": await getClassroomId(),\n            \"message\": {\n              'sdp': pc.localDescription.sdp,\n              'type': pc.localDescription.type,\n            }\n        })\n    )\n}\n\nexport async function onICECandidate(message) {\n    if(pc !== null) {\n        pc.addIceCandidate(new RTCIceCandidate(message.message));\n    }\n}\n\nexport async function startLocalStream(setLocalStream) {\n    const stream = await navigator.mediaDevices.getUserMedia({audio: false, video: true})\n    setLocalStream(stream)\n}\n\nexport function stopLocalStream(setLocalStream) {\n    setLocalStream({})\n}"],"mappings":"AAAA,SAASA,cAAc,QAAQ,4CAA4C;AAC3E,SAASC,SAAS,QAAQ,6CAA6C;AAEvE,MAAMC,UAAU,GAAG;EACf,YAAY,EAAE;EACV;EACA;IACA,KAAK,EAAE,kCAAkC;IACzC,UAAU,EAAE,oBAAoB;IAChC,YAAY,EAAE;EACd,CAAC;AAET,CAAC;AACD,MAAMC,gBAAgB,GAAG;EACrBC,KAAK,EAAE,KAAK;EACZC,KAAK,EAAE;AACX,CAAC;AAED,IAAIC,EAAE,GAAG,IAAI;AAGb,OAAO,eAAeC,UAAUA,CAACC,eAAe,EAAEC,cAAc,EAAEC,OAAO,EAAEC,WAAW,EAAE;EACpFL,EAAE,GAAG,IAAIM,iBAAiB,CAACV,UAAU,CAAC;EAEtCI,EAAE,CAACO,OAAO,GAAIC,KAAK,IAAK;IACpBN,eAAe,CAACM,KAAK,CAACC,OAAO,CAAC,CAAC,CAAC,CAAC;EACrC,CAAC;EAEDT,EAAE,CAACU,cAAc,GAAG,MAAAC,IAAA,IAAuB;IAAA,IAAhB;MAACC;IAAS,CAAC,GAAAD,IAAA;IAClC,IAAGC,SAAS,IAAI,IAAI,EAAE,CAEtB;EACJ,CAAC;EAED,IAAI;IACA,MAAMC,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAACnB,gBAAgB,CAAC;IAC1EgB,MAAM,CAACI,SAAS,EAAE,CAACC,OAAO,CAAGC,KAAK,IAChCnB,EAAE,CAACoB,QAAQ,CAACD,KAAK,EAAEN,MAAM,CAAC,CAC3B;EACL,CAAC,CAAC,OAAOQ,GAAG,EAAE;IACVC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;EACtB;EAEA,MAAMrB,EAAE,CAACwB,oBAAoB,CAAC,IAAIC,qBAAqB,CAACrB,OAAO,CAACA,OAAO,CAAC,CAAC;EAEzE,MAAMJ,EAAE,CAAC0B,mBAAmB,CAAC,MAAM1B,EAAE,CAAC2B,YAAY,EAAE,CAAC;EAErDtB,WAAW,CAACuB,IAAI,CACZC,IAAI,CAACC,SAAS,CAAC;IACX,KAAK,EAAE,QAAQ;IACf,UAAU,EAAEnC,SAAS,EAAE;IACvB,iBAAiB,EAAE,KAAK;IACxB,YAAY,EAAES,OAAO,CAAC2B,QAAQ;IAC9B,aAAa,EAAE,MAAMrC,cAAc,EAAE;IACrC,SAAS,EAAE;MACT,KAAK,EAAEM,EAAE,CAACgC,gBAAgB,CAACC,GAAG;MAC9B,MAAM,EAAEjC,EAAE,CAACgC,gBAAgB,CAACE;IAC9B;EACJ,CAAC,CAAC,CACL;AACL;AAEA,OAAO,eAAeC,cAAcA,CAAC/B,OAAO,EAAE;EAC1C,IAAGJ,EAAE,KAAK,IAAI,EAAE;IACZA,EAAE,CAACoC,eAAe,CAAC,IAAIC,eAAe,CAACjC,OAAO,CAACA,OAAO,CAAC,CAAC;EAC5D;AACJ;AAEA,OAAO,eAAekC,gBAAgBA,CAACnC,cAAc,EAAE;EACnD,MAAMU,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;IAAClB,KAAK,EAAE,KAAK;IAAEC,KAAK,EAAE;EAAI,CAAC,CAAC;EACrFI,cAAc,CAACU,MAAM,CAAC;AAC1B;AAEA,OAAO,SAAS0B,eAAeA,CAACpC,cAAc,EAAE;EAC5CA,cAAc,CAAC,CAAC,CAAC,CAAC;AACtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}